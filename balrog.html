<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>발록 컨텐츠 체크 시스템</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .input-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .nickname-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .list-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .reset-info {
            margin-top: 20px;
            padding: 10px;
            background-color: #e7f3fe;
            border-left: 6px solid #2196F3;
            border-radius: 4px;
        }
        .error-message {
            color: red;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>발록 컨텐츠 체크 시스템</h1>
    
    <div class="input-section">
        <div class="nickname-input">
            <input type="text" id="nicknameInput" placeholder="닉네임을 입력하세요">
            <button id="addButton">추가</button>
        </div>
        <div id="errorMessage" class="error-message"></div>
    </div>
    
    <div class="list-section">
        <h2>닉네임 목록</h2>
        <table id="nicknameTable">
            <thead>
                <tr>
                    <th>닉네임</th>
                    <th>발록 컨텐츠 진행</th>
                    <th>작업</th>
                </tr>
            </thead>
            <tbody id="nicknameList">
                <!-- 닉네임 목록이 여기에 추가됩니다 -->
            </tbody>
        </table>
        
        <div class="reset-info">
            <p>발록 컨텐츠 진행 여부는 매일 자정(00:00)에 초기화됩니다.</p>
            <p>다음 초기화까지 남은 시간: <span id="resetTimer"></span></p>
        </div>
    </div>

    <script>
        // 로컬 스토리지에서 데이터 로드
        let nicknames = JSON.parse(localStorage.getItem('nicknames')) || [];
        let lastResetDate = localStorage.getItem('lastResetDate') || new Date().toDateString();
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            renderNicknameList();
            updateResetTimer();
            setInterval(updateResetTimer, 1000);
            checkDailyReset();
            
            // 엔터 키로도 추가 가능하도록 설정
            document.getElementById('nicknameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNickname();
                }
            });
            
            document.getElementById('addButton').addEventListener('click', addNickname);
        });
        
        // 닉네임 추가 함수
        function addNickname() {
            const nicknameInput = document.getElementById('nicknameInput');
            const errorMessage = document.getElementById('errorMessage');
            const nickname = nicknameInput.value.trim();
            
            errorMessage.textContent = '';
            
            if (!nickname) {
                errorMessage.textContent = '닉네임을 입력해주세요.';
                return;
            }
            
            if (nicknames.some(item => item.name.toLowerCase() === nickname.toLowerCase())) {
                errorMessage.textContent = '이미 존재하는 닉네임입니다.';
                return;
            }
            
            nicknames.push({
                name: nickname,
                balrogCompleted: false,
                addedDate: new Date().toISOString()
            });
            
            saveToLocalStorage();
            renderNicknameList();
            nicknameInput.value = '';
            nicknameInput.focus();
        }
        
        // 닉네임 목록 렌더링
        function renderNicknameList() {
            const tbody = document.getElementById('nicknameList');
            tbody.innerHTML = '';
            
            if (nicknames.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 3;
                td.textContent = '등록된 닉네임이 없습니다.';
                td.style.textAlign = 'center';
                td.style.color = '#999';
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }
            
            nicknames.forEach((item, index) => {
                const tr = document.createElement('tr');
                
                // 닉네임 셀
                const nameTd = document.createElement('td');
                nameTd.textContent = item.name;
                tr.appendChild(nameTd);
                
                // 발록 컨텐츠 체크박스 셀
                const balrogTd = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = item.balrogCompleted;
                checkbox.addEventListener('change', function() {
                    nicknames[index].balrogCompleted = this.checked;
                    saveToLocalStorage();
                });
                balrogTd.appendChild(checkbox);
                tr.appendChild(balrogTd);
                
                // 삭제 버튼 셀
                const actionTd = document.createElement('td');
                const deleteButton = document.createElement('button');
                deleteButton.textContent = '삭제';
                deleteButton.addEventListener('click', function() {
                    if (confirm(`'${item.name}'을(를) 목록에서 삭제하시겠습니까?`)) {
                        nicknames.splice(index, 1);
                        saveToLocalStorage();
                        renderNicknameList();
                    }
                });
                actionTd.appendChild(deleteButton);
                tr.appendChild(actionTd);
                
                tbody.appendChild(tr);
            });
        }
        
        // 로컬 스토리지에 저장
        function saveToLocalStorage() {
            localStorage.setItem('nicknames', JSON.stringify(nicknames));
            localStorage.setItem('lastResetDate', lastResetDate);
        }
        
        // 초기화 타이머 업데이트
        function updateResetTimer() {
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            
            const diff = midnight - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('resetTimer').textContent = 
                `${hours}시간 ${minutes}분 ${seconds}초`;
        }
        
        // 매일 자정에 체크 초기화 확인
        function checkDailyReset() {
            const today = new Date().toDateString();
            
            if (lastResetDate !== today) {
                // 날짜가 변경되었으면 모든 체크박스 초기화
                nicknames = nicknames.map(item => {
                    return {
                        ...item,
                        balrogCompleted: false
                    };
                });
                
                lastResetDate = today;
                saveToLocalStorage();
                renderNicknameList();
            }
        }
    </script>
</body>
</html>